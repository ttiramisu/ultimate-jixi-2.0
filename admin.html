<!doctype html>
<html lang="zh-Hans">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Set Exec</title>
  <link rel="stylesheet" href="/css/admin.css">
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Admin — 设置主投票 /exec（公开）</h1>
    </header>
    <main>
      <section class="guide-section">
        <label for="appsScriptURL">主投票 Sheets 的 Apps Script /exec URL</label>
        <input id="appsScriptURL" type="text" placeholder="https://script.google.com/macros/s/.../exec" />
        <button id="saveURL" class="btn">保存到 Firebase (config/execURL)</button>
        <p style="color:#9fb0d9;margin-top:8px">注意：此 Admin 页面没有密码，任何人都可以更改 Exec 链接。</p>
      </section>
    </main>
  </div>

  <div id="toast" class="toast"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="/js/firebase-config.js"></script>

  <script>
    const appsScriptInput = document.getElementById('appsScriptURL');
    const saveURLBtn = document.getElementById('saveURL');
    const toastEl = document.getElementById('toast');

    function showToast(msg, timeout = 2800) {
      toastEl.textContent = msg; toastEl.classList.add('show');
      clearTimeout(toastEl._t); toastEl._t = setTimeout(() => toastEl.classList.remove('show'), timeout);
    }

    // Save to Realtime DB path /config/execURL
    saveURLBtn.addEventListener('click', async () => {
      const url = appsScriptInput.value.trim();
      if (!url) { showToast('请输入有效 URL'); return; }
      try {
        const db = firebase.database();
        await db.ref('config/execURL').set(url);
        showToast('已保存 exec URL 到 Firebase');
      } catch (err) {
        console.error(err);
        showToast('保存失败');
      }
    });

    // Optional: load current url on page load
    (async function loadCurrent() {
      try {
        const db = firebase.database();
        const snap = await db.ref('config/execURL').get();
        if (snap.exists()) appsScriptInput.value = snap.val();
      } catch (e) { console.warn('无法读取当前 exec'); }
    })();
  </script>
</body>

</html>